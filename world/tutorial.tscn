[gd_scene load_steps=15 format=3 uid="uid://d03y35yvqf4jr"]

[ext_resource type="TileSet" uid="uid://b7em4re6t2a80" path="res://asset/tile/tileset.tres" id="1_vja1d"]
[ext_resource type="Texture2D" uid="uid://cff1v6m72cv" path="res://asset/background/basalt.png" id="2_s5g0k"]
[ext_resource type="Texture2D" uid="uid://de6v6s2w7dvmv" path="res://asset/tile/heart.png" id="3_gkovb"]
[ext_resource type="PackedScene" uid="uid://2oex1jniyl2w" path="res://node/switch_bridge.tscn" id="3_ooh3f"]
[ext_resource type="Script" path="res://node/triggers/battle_trigger.gd" id="4_2jv7s"]
[ext_resource type="PackedScene" uid="uid://bey6fhrbn55h0" path="res://node/actor/actor.tscn" id="5_vcfcg"]
[ext_resource type="Resource" uid="uid://c520hdu6q2tad" path="res://resource/action/default.tres" id="6_hkasy"]
[ext_resource type="Resource" uid="uid://caiv82vs4t3u1" path="res://resource/actor/fungus.tres" id="6_j7gqy"]
[ext_resource type="Script" path="res://resource/actor/enemy_actor.gd" id="7_a0yh2"]
[ext_resource type="SpriteFrames" uid="uid://dij16ejkcheu6" path="res://asset/actor/sprite/fungus.tres" id="8_enm0b"]
[ext_resource type="SpriteFrames" uid="uid://bvdfj5mwyubmf" path="res://asset/actor/sprite/fungus2.tres" id="10_dvw84"]

[sub_resource type="GDScript" id="GDScript_d6xrq"]
resource_name = "battle"
script/source = "extends Node2D


func _setup() -> void:
	$Actor1.data.health_changed.connect(_phase_2.unbind(1), CONNECT_ONE_SHOT)


func _phase_2() -> void:
	await Battle.turn_ended
	
	var actor2: Actor = $Actor2.data
	Battle.add_actor(actor2)
	Battle.add_actor($Actor3.data)
	
	actor2.turn_override = [
		actor2.follow_path.bind([
			Vector2i(9, 30),
			Vector2i(8, 30),
			Vector2i(7, 30),
			Vector2i(6, 30),
		]),
		$\"../Bridge2\".on_interact
	]
	await actor2.turn_ended
"

[sub_resource type="Resource" id="Resource_4h2r3"]
script = ExtResource("7_a0yh2")
keep_distance = 0
preferred_facing = Vector2i(0, 1)
name = "Fungal Watchman"
max_health = 15
defense = 0
resistance = 0
evasion = 0.0
tiles_per_turn = 5
actions_per_turn = 1
actions = Array[Resource("res://resource/script/action.gd")]([ExtResource("6_hkasy")])
attributes = Array[Resource("res://resource/script/attribute.gd")]([])
sprite = ExtResource("8_enm0b")
sprite_offset = Vector2i(0, -6)
description = "..."
weak_against = Array[int]([])
strong_against = Array[int]([])

[sub_resource type="Resource" id="Resource_bx1nt"]
script = ExtResource("7_a0yh2")
keep_distance = 0
preferred_facing = Vector2i(0, 0)
name = "Fungus2"
max_health = 10
defense = 0
resistance = 0
evasion = 1.0
tiles_per_turn = 5
actions_per_turn = 1
actions = Array[Resource("res://resource/script/action.gd")]([ExtResource("6_hkasy")])
attributes = Array[Resource("res://resource/script/attribute.gd")]([])
sprite = ExtResource("10_dvw84")
sprite_offset = Vector2i(0, -6)
description = "..."
weak_against = Array[int]([])
strong_against = Array[int]([])

[node name="Tutorial" type="Node2D"]
y_sort_enabled = true

[node name="ParallaxBackground" type="ParallaxBackground" parent="."]

[node name="ParallaxLayer" type="ParallaxLayer" parent="ParallaxBackground"]
motion_scale = Vector2(0.5, 0.5)
motion_mirroring = Vector2(500, 300)

[node name="Sprite2D" type="Sprite2D" parent="ParallaxBackground/ParallaxLayer"]
texture = ExtResource("2_s5g0k")
centered = false

[node name="TileMap" type="TileMap" parent="."]
y_sort_enabled = true
tile_set = ExtResource("1_vja1d")
format = 2
layer_0/name = "floor"
layer_0/y_sort_enabled = true
layer_0/y_sort_origin = -8
layer_0/z_index = -2
layer_0/tile_data = PackedInt32Array(-1, 131074, 0, 65535, 65538, 0, -2, 65538, 0, -65537, 65538, 0, -131073, 2, 0, -131072, 2, 0, 0, 131074, 1, 131071, 65538, 1, -65536, 65538, 0, 65536, 131074, 0, 131073, 65538, 0, 1, 2, 0, 65537, 2, 0, 131072, 131074, 1, 196608, 2, 0, -131074, 65538, 0, -196609, 2, 0, -131071, 65538, 1, -196608, 65538, 1, -65535, 2, 0, 458754, 131074, 0, 458753, 65538, 0, 262145, 131074, 0, 327680, 2, 0, 393216, 2, 0, 458752, 2, 0, 524289, 65538, 1, 393217, 65538, 0, 524290, 131074, 0, 589825, 65538, 1, 589824, 65538, 1, 655363, 65538, 1, 589827, 131074, 0, 524291, 131074, 0, 458755, 2, 0, 524292, 65538, 1, 589828, 2, 0, 655364, 2, 1, 458756, 65538, 0, 524293, 65538, 1, -65538, 0, 0, -196610, 0, 0, -262146, 0, 0, -262145, 0, 0, -262144, 0, 0, -262143, 0, 0, 262144, 2, 0, 262143, 131074, 1, 65534, 131074, 1, 2, 2, 0, 131074, 2, 0, 196609, 2, 0, -196607, 131074, 0, -131070, 65538, 0, 196610, 65538, 1, 262147, 2, 0, 393219, 2, 0, 393220, 65538, 1, 393221, 2, 0, 458757, 2, 0, 720899, 2, 0, 720898, 131074, 1, 589826, 2, 0, 655362, 65538, 0, 655361, 131074, 0, 655360, 2, 0, 524288, 131074, 0, 524287, 2, 0, 393215, 65538, 0, 327681, 65538, 2, 196606, 65538, 2, 720900, 3, 0, 655365, 3, 0, 589829, 3, 0, 655366, 3, 0, 720901, 3, 0, 786437, 3, 0, 851972, 3, 0, 786436, 3, 0, 524294, 3, 1, 589830, 3, 0, 655367, 3, 0, 720902, 3, 0, 786438, 3, 0, 917509, 3, 0, 851973, 3, 0, 917511, 65538, 1, 983046, 65538, 1, 1048583, 131074, 0, 983047, 65538, 1, 917512, 2, 0, 786439, 2, 1, 917510, 2, 1, 851974, 2, 0, 851975, 65538, 1, 851971, 3, 0, 917508, 3, 1, 983043, 65539, 2, 1048579, 65539, 3, 983044, 3, 0, 1048580, 3, 0, 1114115, 3, 0, 1048584, 2, 0, 983048, 65538, 1, 1114119, 2, 0, 1114118, 2, 0, 1179655, 65538, 0, 851976, 2, 0, 917513, 65538, 1, 1048585, 65538, 0, 1114120, 131074, 0, 1179656, 65538, 1, 1114121, 65538, 0, 1179657, 2, 0, 1245192, 131074, 0, 1245193, 2, 0, 1310729, 2, 0, 1376264, 131074, 1, 1441801, 2, 0, 1310730, 2, 0, 1376265, 131074, 0, 1310728, 65538, 0, 1507336, 131074, 0, 1441802, 2, 0, 1507337, 65538, 1, 1572873, 2, 0, 1638410, 65538, 1, 1572875, 65538, 1, 1507339, 2, 0, 1572876, 2, 0, 1638411, 2, 0, 1703947, 131074, 0, 1900553, 131074, 1, 1900554, 65538, 0, 1835019, 2, 0, 1769483, 65538, 1, 1703948, 131074, 0, 1638412, 2, 0, 1507340, 65538, 0, 1572877, 131074, 0, 1966091, 131074, 0, 1900555, 2, 0, 1835020, 131074, 0, 1769484, 2, 0, 2162698, 2, 1, 2228235, 2, 1, 2228236, 2, 1, 2162699, 2, 1, 2097164, 2, 0, 2031627, 131074, 1, 1966092, 2, 0, 2097163, 2, 0, 1900556, 65538, 0, 1835021, 131074, 0, 1769486, 65538, 1, 1900558, 2, 0, 1966094, 131074, 1, 2031629, 2, 0, 2097165, 2, 0, 2162700, 65538, 1, 2031628, 65538, 0, 1966093, 131074, 1, 1900557, 2, 0, 1835022, 131074, 0, 2031630, 131074, 1, 2097166, 2, 0, 2162701, 65538, 0, 2228237, 65538, 0, 1507341, 65538, 1, 1572878, 65538, 0, 1638414, 2, 0, 1703951, 65538, 0, 1769487, 65538, 0, 1835023, 131074, 1, 1900559, 2, 0, 1966095, 2, 0, 2031631, 131074, 0, 2097167, 2, 0, 2162702, 131074, 1, 2228238, 131074, 1, 2293773, 131074, 1, 2293772, 131074, 0, 2293771, 2, 1, 1507338, 65538, 1, 1572874, 2, 0, 1638409, 131074, 1, 2031626, 65538, 1, 2097162, 65538, 1, 2031625, 65538, 1, 1966090, 131074, 0, 1703949, 65538, 2, 1769481, 65538, 2, 2162697, 65539, 2, 2228234, 65539, 2, 2293770, 65539, 1, 2359308, 0, 0, 2359309, 0, 0, 2359310, 0, 0, 2293774, 0, 0, 2228239, 0, 0, 2162703, 2, 0, 2097168, 65538, 0, 1966096, 65538, 0, 1835024, 65538, 1, 1638415, 2, 0, 1572879, 65538, 1, 983045, 131074, 1, 1376266, 65538, 0, 1441803, 65538, 1, 1441804, 65538, 1, 1441805, 131074, 1, 1376268, 131074, 0, 1376269, 131074, 1, 1441806, 2, 0, 1507342, 2, 0, 1900560, 131074, 1, 2031632, 65538, 0, 2162704, 65538, 1, 2097169, 131074, 1, 2162705, 131074, 0, 2031633, 2, 0, 1966097, 2, 0, 1966089, 131074, 1, 1900552, 65538, 0, 1835017, 2, 0, 1769480, 131074, 1, 1703945, 131074, 1, 458758, 3, 1, 524295, 3, 1, 589831, 3, 1, 393223, 131075, 0, 458759, 131075, 0, 524296, 131075, 0, -196601, 65539, 1, -131064, 65539, 0, -65528, 65539, 0, -262136, 65539, 1, -196600, 65539, 1, -131063, 65539, 1, -196599, 65539, 2, -262135, 65539, 1, -327671, 65539, 2, -327672, 65539, 1, -393207, 65539, 2, -262134, 65539, 2, -327670, 65539, 3, -393206, 65539, 2, -458743, 65539, 3, -524278, 65539, 3, -458742, 65539, 3, -393205, 65539, 3, 1245187, 3, 0, 1376262, 3, 0, 1441798, 3, 0, 1507333, 3, 0, 1507335, 3, 0, 1441799, 3, 0, 1507334, 3, 0, 1572871, 3, 0, 1638406, 3, 0, 1572870, 3, 0, 1703943, 3, 0, 1835015, 3, 0, 1966087, 3, 0, 1769478, 3, 0, 2097160, 65539, 3, 2162695, 65539, 3, 2228232, 65539, 2, 2031623, 3, 0, 2097159, 65539, 3, 2031622, 3, 0, 1900550, 3, 0, 1179651, 3, 0, 1572869, 3, 0, 1703942, 3, 0, 2162696, 65539, 3, 2228233, 65539, 2, 2293768, 65539, 2, 2359305, 65539, 1, 2293769, 65539, 1, 2359306, 65539, 1, 2424841, 65539, 1, 2490378, 65539, 0, 2359307, 65539, 1, 2424842, 65539, 0, 1114114, 3, 0, 1376260, 65539, 3, 1376261, 3, 0, 1441797, 3, 0, 1507332, 3, 0, 1572868, 3, 0, 1507331, 3, 0, 1441796, 3, 1, 1638404, 3, 0, 1703940, 3, 0, 1638403, 3, 0, 1572867, 3, 0, 1703939, 3, 0, 1769475, 3, 0, 1769474, 3, 0, 1703938, 3, 0, 1638402, 3, 0, 1245186, 3, 0, 1310723, 3, 0, 1376258, 3, 0, 1310722, 3, 0, 1245185, 3, 0, 1310721, 3, 0, 1376257, 3, 0, 1441794, 3, 0, 1507329, 3, 0, 1441793, 3, 0, 1376256, 3, 0, 1572865, 3, 0, 1638401, 3, 0, 1572866, 3, 0, 1310725, 65539, 3, 1310726, 3, 0, 1835014, 3, 0, 1966086, 3, 0, 1769477, 3, 0, 1900549, 3, 0, 2424840, 65539, 2, 2359304, 65539, 2, 2293767, 65539, 3, 2228231, 65539, 3, 2162694, 3, 0, 2097158, 3, 0, 2031621, 3, 0, 1769479, 3, 0, 1638407, 3, 0, 1572872, 65538, 0, 1179652, 3, 0, 1114116, 3, 0, 917507, 3, 0, 983042, 3, 0, 1769473, 3, 0, 1703937, 3, 0, 1638400, 3, 0, 1179653, 2, 0, 1245188, 131074, 0, 1310724, 3, 1, 1376259, 2, 0, 1441795, 2, 0, 1507330, 65538, 0, 1245189, 2, 0, 1048581, 65538, 1, 1048582, 2, 0, 1114117, 131074, 1, 1179654, 65538, 1, 1245190, 2, 0, 1310727, 65538, 0, 1441800, 2, 0, 1835011, 3, 0, 1835010, 3, 0, 1507328, 3, 0, 1966085, 65539, 3, 1835013, 65539, 3, 1900551, 65538, 0, 1966088, 2, 0, 2031624, 2, 0, 2097161, 2, 0, 1638405, 65538, 1, 1703941, 131074, 0, 1769476, 131074, 0, 1835012, 131074, 1, 1900548, 131074, 1, 1966084, 131074, 1, 1900547, 65538, 0, 1179649, 65538, 0, 1245184, 131074, 1, 1114113, 131074, 0, 3211277, 131074, 0, 3342349, 2, 1, 3080206, 65538, 1, 3145742, 65538, 0, 3211278, 131074, 0, 3276814, 65538, 1, 3342350, 2, 0, 3407886, 2, 1, 3473422, 131074, 0, 3014671, 65538, 0, 3080207, 2, 0, 3145743, 131074, 1, 3211279, 2, 0, 3276815, 131074, 0, 3342351, 65538, 0, 3407887, 2, 0, 3473423, 2, 0, 3538959, 65538, 0, 3014672, 2, 0, 3080208, 65538, 1, 3145744, 2, 0, 3211280, 2, 0, 3276816, 65538, 0, 3342352, 2, 0, 3407888, 131074, 1, 3473424, 65538, 0, 3538960, 2, 0, 3145745, 65538, 0, 3211281, 2, 0, 3276817, 65538, 0, 3342353, 131074, 1, 3407889, 65538, 0, 3080202, 131075, 65536, 3014667, 131075, 65536, 2949131, 131075, 65536, 3145740, 3, 1, 3211275, 3, 0, 3342347, 3, 0, 3276812, 3, 0, 3342348, 3, 0, 3407884, 3, 0, 3473419, 3, 0, 3407885, 3, 0, 3473420, 3, 0, 3538956, 3, 0, 3604492, 3, 0, 3538957, 3, 0, 3473421, 3, 0, 3538958, 3, 0, 3604493, 3, 0, 3670029, 3, 0, 3407883, 3, 0, 3276813, 131074, 1, 3211276, 2, 0, 3080204, 3, 1, 3145741, 65538, 1, 3080205, 2, 0, 3014670, 2, 0, 2883599, 65538, 0, 2949134, 131074, 1, 2949135, 131074, 1, 3276811, 3, 0, 3342346, 3, 0, 3014668, 3, 1, 3080203, 3, 0, 3145739, 3, 1, 3211274, 3, 0, 2555914, 65539, 0, 2490379, 65539, 0, 2424843, 65539, 0, -131065, 65539, 0, -65529, 65539, 0, 8, 65539, 0, 1703944, 3, 1, 1179650, 3, 0, 917506, 3, 1, 851970, 3, 1, 1048578, 3, 1, 983056, 65538, 1, 1114128, 65538, 0, 917521, 65538, 2, 1048593, 131074, 0, 1114129, 131074, 1, 1376273, 131074, 0, 1507345, 2, 0, 1179666, 2, 0, 1245202, 2, 0, 1310738, 131074, 1, 1376274, 131074, 1, 1441810, 65538, 1, 1507346, 2, 0, 1572882, 2, 0, 1245203, 131074, 0, 1310739, 131074, 0, 1376275, 65538, 1, 1441811, 65538, 0, 1507347, 65538, 0, 1572883, 65538, 0, 1310740, 2, 0, 1441812, 131074, 1, 917520, 131074, 1, 1048592, 131074, 0, 851984, 2, 0, 1310737, 65538, 1, 1441809, 65538, 0, 1048594, 65538, 1, 1245201, 131074, 1, 1179667, 2, 0, 655369, 196610, 2, 393224, 196610, 2, 655368, 393218, 0, 65544, 131074, 1, 9, 131074, 0, 65545, 65538, 1, 131081, 65538, 0, -65527, 2, 0, 10, 65538, 0, -65526, 131074, 0, -131062, 131074, 0, 196616, 131074, 1)
layer_1/name = "objects"
layer_1/y_sort_enabled = true
layer_1/tile_data = PackedInt32Array(196609, 262146, 0, 131074, 196610, 1, 2, 262146, 0, -131070, 196610, 0, -196607, 262146, 0, 196610, 196610, 1, 262147, 196610, 0, 393219, 196610, 1, 393220, 393218, 2, 393221, 196610, 1, 458757, 262146, 1, 589826, 196610, 0, 655362, 262146, 1, 655361, 196610, 0, 655360, 196610, 0, 524288, 262146, 1, 524287, 262146, 0, 262143, 262146, 1, 262144, 196610, 1, 393215, 262146, 0, 262142, 196610, 1, 196606, 196610, 0, 720898, 262146, 0, 720899, 196610, 1, 65534, 196610, 1, 720900, 0, 0, 786437, 0, 0, 851973, 0, 0, 589829, 0, 0, 655366, 0, 0, 720902, 0, 0, 917508, 131074, 0, 1048582, 262146, 0, 1179654, 262146, 0, 1245190, 262146, 0, 1245191, 262146, 0, 983049, 262146, 1, 851977, 262146, 1, 786441, 262146, 0, 786440, 196610, 0, 720903, 196610, 0, 655368, 262146, 1, 1376263, 196610, 1, 1441800, 196610, 1, 1572872, 196610, 1, 1638408, 262146, 0, 1376266, 196610, 1, 1245194, 262146, 0, 1179658, 262146, 0, 1048586, 196610, 0, 1441803, 196610, 1, 1703945, 262146, 0, 1638409, 262146, 1, 1835017, 196610, 0, 1966089, 196610, 1, 2097161, 393218, 2, 1441805, 262146, 0, 1441804, 196610, 0, 1835020, 393218, 0, 1900557, 196610, 1, 2031628, 262146, 0, 1966091, 196610, 0, 1441806, 262146, 0, 1507342, 196610, 1, 1376267, 393218, 2, 1376268, 196610, 0, 1376269, 262146, 1, 1769480, 196610, 0, 917514, 196610, 0, 720904, 327682, 0, 720905, 393218, 2, 524297, 393218, 0, 1310727, 393218, 0, 1310726, 393218, 0, 1310731, 393218, 0, 1114122, 327682, 0, 1245195, 327682, 2, 1245196, 393218, 0, 327683, 327682, 0, 65538, 393218, 2, 262148, 327682, 2, 262149, 393218, 0, 327684, 262146, 1, 983040, 327682, 2, 1048577, 327682, 0, 1048576, 393218, 0, 1114112, 262146, 1, 983041, 262146, 0, 1114113, 196610, 1, 1114111, 196610, 1, 1572879, 262146, 1, 1638415, 262146, 0, 1835024, 196610, 0, 1966096, 196610, 0, 2097168, 262146, 0, 2162703, 262146, 1, 1900560, 393218, 2, 1966097, 262146, 1, 2031632, 393218, 0, 2097169, 196610, 1, 2162704, 262146, 0, 2162705, 196610, 0, 1769484, 196610, 2, 1900555, 262146, 1, 1835019, 196610, 0, 1769483, 262146, 1, 1769485, 196610, 0, 1835021, 196610, 1, 2031624, 262146, 0, 1900551, 196610, 2, 1441795, 393218, 0, 1376259, 262146, 1, 3211276, 262146, 0, 2949133, 262146, 1, 3014669, 327682, 0, 3080205, 262146, 1, 3145741, 262146, 0, 3276813, 196610, 0, 2949134, 196610, 1, 3014670, 327682, 2, 2818063, 262146, 1, 2883599, 327682, 0, 2949135, 262146, 0, 2883600, 262146, 0, 1769476, 262146, 0, 1835012, 196610, 0, 2359307, 0, 0, 2293770, 0, 0, 2228234, 0, 0, 2162697, 0, 0, 327688, 327682, 2, 2031633, 327682, 2)

[node name="Sprite2D" type="Sprite2D" parent="TileMap"]
position = Vector2(416, 64)
texture = ExtResource("3_gkovb")

[node name="Bridge" parent="." instance=ExtResource("3_ooh3f")]
position = Vector2(168, 88)

[node name="Battle" type="Node2D" parent="."]
visible = false
y_sort_enabled = true
script = SubResource("GDScript_d6xrq")

[node name="BattleTrigger" type="Area2D" parent="Battle"]
position = Vector2(144, 72)
collision_layer = 0
script = ExtResource("4_2jv7s")
actors = Array[NodePath]([NodePath("../Actor1")])
region = Rect2i(-6, 0, 18, 24)
mode = 1

[node name="Actor1" parent="Battle" instance=ExtResource("5_vcfcg")]
position = Vector2(320, 160)
data = SubResource("Resource_4h2r3")

[node name="Actor2" parent="Battle" instance=ExtResource("5_vcfcg")]
position = Vector2(640, 176)
data = ExtResource("6_j7gqy")

[node name="Actor3" parent="Battle" instance=ExtResource("5_vcfcg")]
position = Vector2(560, 120)
data = SubResource("Resource_bx1nt")

[node name="Bridge2" parent="." instance=ExtResource("3_ooh3f")]
position = Vector2(568, 200)
rotation = 3.14159
scale = Vector2(1, -1)

[connection signal="triggered" from="Battle/BattleTrigger" to="Battle" method="_setup"]
